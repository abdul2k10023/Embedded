# Commands for build

## steps done for basic Cmake build
* created a the build using Cmake using the makefile generated by the stmCUBEMX tool. Just to get a gist of whats required.
* ingredients:
    * linker file .ld... mcu specific
    * startup file .s ... mcu specific
    * compiler definitions
    * target compile options... specific to target mcu.... including ,mcpu,fpu,abi hard  etc.
    * target link options... mcu specific
    * include directories

## cmake

Commands for running cmake and building afterwards.
* cmake -G "Unix Makefiles" -DCMAKE_TOOLCHAIN_FILE=../arm-none-eabi-gcc.cmake -DCMAKE_BUILD_TYPE=Debug ..
* make -jx OR cmake --build . -- -jx

## flashing
* download OpenOCD
> sudo apt-get install openocd
* Try finding your stm board config file in Usr/share/openocd/scripts/board/xxxx, download from the web if necessary.
* Create rules for the stlink programmer:
> sudo nano /etc/udev/rules.d/stlink.rules
* write the following in the file, idProduct,idVendor can be different in your case, trying finding it using *lsusb*

KERNEL=="tty[A-Z]*[0-9]", MODE="0666"

#STLINK V2 and V2.1

ATTRS{idProduct}=="3748", ATTRS{idVendor}=="0483", MODE="666", GROUP="plugdev"

> sudo service udev restart
* Now there are 3 Options ahead
   * You can use openocd from the terminal and telnet to local host 4444:
      > openocd -f "board/your_board_config_file.cfg"
      * in an other terminal now:
      > telnet localhost 4444
      * Issue Commands like this in sequence:
 
      > init
      > 
      > reset init
      > 
      > halt
      > 
      > flash write_image erase myprogram.elf
      > 
      > exit
   * You can also open GDB debugger in another terminal:
      > arm-none-eabi-gdb myprogram.elf
   * Third option is to just flash the Board with the hex file, this invokes a default openocd script that performs program/verify/reset the target and optionally shutdown:
      >  openocd -f board/st_nucleo_l073rz.cfg -c "program nucleo_l073rz_initialize.hex verify reset exit"


## future steps

* Use C++ code and a c++ compiler to wrap it around the C code.
* Explore further features of Cmake and Make.
* Automate Cmake and make using bash scripts.
* Implement FreeRTOS and CMSIS.
